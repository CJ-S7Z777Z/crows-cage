<!-- public/page2.html -->

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Crow Cage - Account Rarity</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Подключение шрифта Rubik Wet Paint -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Wet+Paint&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: 'Rubik Wet Paint', cursive;
      background-color: #000;
      color: #fff;
      position: relative;
      overflow: hidden;
    }

    .header {
      position: absolute;
      top: 36px; /* Y = 36px */
      left: 8px;  /* X = 8px */
      display: flex;
      align-items: center;
    }

    #logo {
      width: 50px;
      height: 50px;
      background-image: url('logo.png'); /* Замените на путь к вашему логотипу */
      background-size: contain;
      background-repeat: no-repeat;
      margin-right: 10px;
    }

    .header-text {
      font-size: 35px; /* 35px как указано */
    }

    .parameters {
      margin-top: 85px;
      padding: 0 20px;
    }

    .parameter {
      display: flex;
      justify-content: space-between;
      font-size: 35px;
      margin-bottom: 20px;
    }

    .total {
      margin-top: 50px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .total-text {
      font-size: 55px;
    }

    .total-crow {
      font-size: 35px;
    }

    #then-button {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 370px;
      height: 60px;
      background-color: rgba(255, 255, 255, 0.73);
      border: none;
      border-radius: 8px;
      box-shadow: 0px 0.7px 0.6px rgba(0, 0, 0, 0.25);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <div class="header">
    <div id="logo"></div>
    <div class="header-text">Your account rarity</div>
  </div>

  <div class="parameters">
    <div class="parameter">
      <span>Premium</span>
      <span id="premium">0</span>
    </div>
    <div class="parameter">
      <span>Language</span>
      <span id="language">0</span>
    </div>
    <div class="parameter">
      <span>Account age</span>
      <span id="account-age">0</span>
    </div>
    <div class="parameter">
        <span>Bonus</span>
        <span id="bonus">0</span>
      </div>
    </div>
  
    <div class="total">
      <div class="total-text">TOTAL</div>
      <div>
        <span id="total">0</span> <span class="total-crow">$crow</span>
      </div>
    </div>
  
    <button id="then-button">THEN</button>
  
    <!-- Telegram Web App JS SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
      const tg = window.Telegram.WebApp;
  
      // Отключение кнопки назад
      history.pushState(null, null, location.href);
      window.onpopstate = function () {
        history.go(1);
      };
  
      // Вход в полноэкранный режим
      tg.expand();
      tg.requestFullscreen();
  
      const user = tg.initDataUnsafe.user;
      const user_id = user.id;
      const isPremium = user.is_premium;
      const languageCode = user.language_code;
  
      // Определение очков за язык
      let languagePoints = 0;
      if (languageCode === 'en') {
        languagePoints = 75;
      } else if (languageCode === 'ru') {
        languagePoints = 85;
      } else {
        // Можно добавить больше языков или установить значение по умолчанию
        languagePoints = 0;
      }
  
      // Определение очков за премиум
      const premiumPoints = isPremium ? 250 : 0;
  
      // Генерация случайных очков за возраст аккаунта и бонус
      const accountAgePoints = Math.floor(Math.random() * (100 - 45 + 1)) + 45; // от 45 до 100
      const bonusPoints = Math.floor(Math.random() * (175 - 75 + 1)) + 75; // от 75 до 175
  
      // Вычисление общего количества очков
      const totalPoints = premiumPoints + languagePoints + accountAgePoints + bonusPoints;
  
      // Функция для анимации подсчета
      function animateCount(id, start, end, duration) {
        const element = document.getElementById(id);
        let current = start;
        const range = end - start;
        let increment = 1;
        let stepTime = Math.abs(Math.floor(duration / range));
        
        if (range < 0) {
          increment = -1;
        }
  
        const timer = setInterval(() => {
          current += increment;
          element.textContent = current;
          if (current === end) {
            clearInterval(timer);
          }
        }, stepTime);
      }
  
      // Запуск анимации подсчета
      animateCount('premium', 0, premiumPoints, 1000);
      animateCount('language', 0, languagePoints, 1000);
      animateCount('account-age', 0, accountAgePoints, 1000);
      animateCount('bonus', 0, bonusPoints, 1000);
      animateCount('total', 0, totalPoints, 1000);
  
      // Функция для сохранения данных пользователя на сервере
      async function saveUserData() {
        try {
          const response = await fetch('/save-user-data', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              user_id: user_id,
              premium: premiumPoints,
              language: languagePoints,
              account_age: accountAgePoints,
              bonus: bonusPoints,
              total: totalPoints,
            }),
          });
  
          if (!response.ok) {
            throw new Error('Failed to save user data.');
          }
  
          // После сохранения можно выполнить дополнительные действия, например, перейти на следующую страницу
        } catch (error) {
          console.error(error);
        }
      }
  
      // Вызов функции сохранения после завершения анимации
      setTimeout(saveUserData, 1200); // Ждем завершения анимации
  
      // Обработка клика на кнопку THEN
      document.getElementById('then-button').addEventListener('click', () => {
        // Переход на третью страницу
        window.location.href = '/third.html';
      });
    </script>
  </body>
  </html>
  